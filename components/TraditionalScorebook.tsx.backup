'use client'

import { useEffect, useState } from 'react'
import { supabase } from '@/lib/supabase'
import DiamondCanvas from './DiamondCanvas'

interface Player {
  id: string
  first_name: string
  last_name: string
  jersey_number: number
  positions: string[]
}

interface Game {
  id: string
  opponent: string
  game_date: string
  our_score: number
  opponent_score: number
  innings_played: number
  game_status: string
  team_id?: string
}

interface AtBat {
  id: string
  player_id: string
  inning: number
  at_bat_number: number
  result: string
  rbi: number
  runs_scored: number
  stolen_bases: number
  base_runners?: { first: boolean, second: boolean, third: boolean, home: boolean }
  base_runner_outs?: { first: boolean, second: boolean, third: boolean, home: boolean }
  notation?: string
  players?: Player
}

export default function TraditionalScorebook({ game, onClose }: { game: Game, onClose: () => void }) {
  const [players, setPlayers] = useState<Player[]>([])
  const [atBats, setAtBats] = useState<AtBat[]>([])
  const [gameInfo, setGameInfo] = useState({
    opponent: game.opponent,
    date: game.game_date,
    startTime: '',
    field: '',
    length: '',
    umpire: ''
  })
  const [loading, setLoading] = useState(true)
  const [selectedCell, setSelectedCell] = useState<{playerId: string, inning: number, playerName: string} | null>(null)
  const [showCanvasModal, setShowCanvasModal] = useState(false)

  useEffect(() => {
    fetchPlayers()
    fetchAtBats()
  }, [game.id])

  async function fetchPlayers() {
    try {
      // If game has a team_id, fetch players in lineup order
      if (game.team_id) {
        const { data: teamData, error: teamError } = await supabase
          .from('teams')
          .select('lineup')
          .eq('id', game.team_id)
          .single()

        if (teamError) {
          console.error('Error fetching team lineup:', teamError)
          // Fallback to jersey number order
          await fetchPlayersByJersey()
          return
        }

        if (teamData?.lineup && teamData.lineup.length > 0) {
          // Fetch players in lineup order
          const { data, error } = await supabase
            .from('players')
            .select('id, first_name, last_name, jersey_number, positions')
            .in('id', teamData.lineup)

          if (error) {
            console.error('Error fetching players by lineup:', error)
            await fetchPlayersByJersey()
            return
          }

          // Sort players according to lineup order
          const sortedPlayers = teamData.lineup
            .map(playerId => data?.find(p => p.id === playerId))
            .filter(Boolean) as Player[]

          setPlayers(sortedPlayers)
        } else {
          // No lineup set, use jersey number order
          await fetchPlayersByJersey()
        }
      } else {
        // No team_id, use jersey number order
        await fetchPlayersByJersey()
      }
    } catch (err) {
      console.error('Failed to fetch players:', err)
      await fetchPlayersByJersey()
    }
  }

  async function fetchPlayersByJersey() {
    try {
      const { data, error } = await supabase
        .from('players')
        .select('id, first_name, last_name, jersey_number, positions')
        .order('jersey_number')

      if (error) {
        console.error('Error fetching players by jersey:', error)
      } else {
        setPlayers(data || [])
      }
    } catch (err) {
      console.error('Failed to fetch players by jersey:', err)
    }
  }

  async function fetchAtBats() {
    try {
      const { data, error } = await supabase
        .from('at_bats')
        .select(`
          *,
          players (
            first_name,
            last_name,
            jersey_number
          )
        `)
        .eq('game_id', game.id)
        .order('inning, at_bat_number')

      if (error) {
        console.error('Error fetching at-bats:', error)
      } else {
        setAtBats(data || [])
        setLoading(false)
      }
    } catch (err) {
      console.error('Failed to fetch at-bats:', err)
      setLoading(false)
    }
  }

  function getAtBatForPlayer(playerId: string, inning: number) {
    return atBats.find(ab => ab.player_id === playerId && ab.inning === inning)
  }

  function getPlayerStats(playerId: string) {
    const playerAtBats = atBats.filter(ab => ab.player_id === playerId)
    return {
      hits: playerAtBats.filter(ab => ['single', 'double', 'triple', 'home_run'].includes(ab.result)).length,
      walks: playerAtBats.filter(ab => ab.result === 'walk').length,
      runs: playerAtBats.reduce((sum, ab) => sum + (ab.runs_scored || 0), 0),
      rbi: playerAtBats.reduce((sum, ab) => sum + (ab.rbi || 0), 0),
      errors: playerAtBats.filter(ab => ab.result === 'error').length
    }
  }

  function handleCellClick(playerId: string, inning: number, playerName: string, existingAtBat?: any) {
    setSelectedCell({ playerId, inning, playerName })
    setShowCanvasModal(true)
  }

  function interpretHandwriting(input: string) {
    const cleanInput = input.trim().toUpperCase()
    
    // Simplified baseball notation mapping - only use values that exist in database constraint
    const notationMap: { [key: string]: string } = {
      // Simple categories
      'HIT': 'single', // Default hit to single
      'OUT': 'ground_out', // Default out to ground out
      
        // Basic hits
        '1B': 'single',
        '2B': 'double', 
        '3B': 'triple',
        'HR': 'home_run',
        'HOMER': 'home_run',
        'HOMERUN': 'home_run',
        'H1': 'single', // Hit single
        'H2': 'double', // Hit double
        'H3': 'triple', // Hit triple
        
        // Infield hits and bunts
        'BUNT': 'single', // Bunt single
        'BUNT_SINGLE': 'single',
        'INFIELD_HIT': 'single',
        'INFIELD_SINGLE': 'single',
      
      // Walks and hit by pitch
      'BB': 'walk',
      'WALK': 'walk',
      'HBP': 'hit_by_pitch',
      'HIT_BY_PITCH': 'hit_by_pitch',
      
      // Strikeouts
      'K': 'strikeout',
      'SO': 'strikeout',
      'STRIKEOUT': 'strikeout',
      
        // Ground outs (fielder to first base)
        'GO': 'ground_out',
        'GROUND_OUT': 'ground_out',
        'BUNT_OUT': 'ground_out', // Bunt out
        'BUNT_GROUND_OUT': 'ground_out',
      '1-3': 'ground_out', // Pitcher to first
      '2-3': 'ground_out', // Catcher to first
      '3-1': 'ground_out', // First to pitcher
      '4-3': 'ground_out', // Second to first
      '5-3': 'ground_out', // Third to first
      '6-3': 'ground_out', // Shortstop to first
      '7-3': 'ground_out', // Left field to first
      '8-3': 'ground_out', // Center field to first
      '9-3': 'ground_out', // Right field to first
      
      // Fly outs (fielder catches ball)
      'FO': 'fly_out',
      'FLY_OUT': 'fly_out',
      'F-1': 'fly_out', // Pitcher catches
      'F-2': 'fly_out', // Catcher catches
      'F-3': 'fly_out', // First baseman catches
      'F-4': 'fly_out', // Second baseman catches
      'F-5': 'fly_out', // Third baseman catches
      'F-6': 'fly_out', // Shortstop catches
      'F-7': 'fly_out', // Left fielder catches
      'F-8': 'fly_out', // Center fielder catches
      'F-9': 'fly_out', // Right fielder catches
      
      // Line outs
      'LO': 'line_out',
      'LINE_OUT': 'line_out',
      'L-1': 'line_out', // Line drive to pitcher
      'L-2': 'line_out', // Line drive to catcher
      'L-3': 'line_out', // Line drive to first
      'L-4': 'line_out', // Line drive to second
      'L-5': 'line_out', // Line drive to third
      'L-6': 'line_out', // Line drive to shortstop
      'L-7': 'line_out', // Line drive to left field
      'L-8': 'line_out', // Line drive to center field
      'L-9': 'line_out', // Line drive to right field
      
      // Pop outs
      'PO': 'pop_out',
      'POP_OUT': 'pop_out',
      'P-1': 'pop_out', // Pop up to pitcher
      'P-2': 'pop_out', // Pop up to catcher
      'P-3': 'pop_out', // Pop up to first
      'P-4': 'pop_out', // Pop up to second
      'P-5': 'pop_out', // Pop up to third
      'P-6': 'pop_out', // Pop up to shortstop
      'P-7': 'pop_out', // Pop up to left field
      'P-8': 'pop_out', // Pop up to center field
      'P-9': 'pop_out', // Pop up to right field
      
      // Errors
      'E': 'error',
      'ERROR': 'error',
      'E-1': 'error', // Error by pitcher
      'E-2': 'error', // Error by catcher
      'E-3': 'error', // Error by first baseman
      'E-4': 'error', // Error by second baseman
      'E-5': 'error', // Error by third baseman
      'E-6': 'error', // Error by shortstop
      'E-7': 'error', // Error by left fielder
      'E-8': 'error', // Error by center fielder
      'E-9': 'error', // Error by right fielder
      
      // Sacrifice plays
      'SF': 'sacrifice_fly',
      'SAC_FLY': 'sacrifice_fly',
      'SACRIFICE_FLY': 'sacrifice_fly',
      'SAC': 'sacrifice_bunt',
      'SAC_BUNT': 'sacrifice_bunt',
      'SACRIFICE_BUNT': 'sacrifice_bunt',
      
        // Fielders choice (mapped to ground_out)
        'FC': 'ground_out',
        'FIELDERS_CHOICE': 'ground_out',
        'FIELDER_CHOICE': 'ground_out',
        'FIELDERS_CHOICE_OUT': 'ground_out',
      
      // Wild pitch and passed ball (mapped to walk)
      'WP': 'walk',
      'WILD_PITCH': 'walk',
      'PB': 'walk',
      'PASSED_BALL': 'walk',
      
      // Balk (mapped to walk)
      'BK': 'walk',
      'BALK': 'walk',
      
      // Interference (mapped to walk)
      'INT': 'walk',
      'INTERFERENCE': 'walk',
      
      // Unassisted plays
      'U-1': 'ground_out', // Unassisted by pitcher
      'U-3': 'ground_out', // Unassisted by first baseman
      'U-4': 'ground_out', // Unassisted by second baseman
      'U-5': 'ground_out', // Unassisted by third baseman
      'U-6': 'ground_out', // Unassisted by shortstop
      
      // Force outs
      'FO-1': 'ground_out', // Force out at first
      'FO-2': 'ground_out', // Force out at second
      'FO-3': 'ground_out', // Force out at third
      'FO-H': 'ground_out', // Force out at home
    }
    
    const result = notationMap[cleanInput] || 'ground_out' // Default to ground_out if not recognized
    console.log(`Interpreted "${cleanInput}" as "${result}"`)
    return result
  }

  async function saveAtBat(notation: string, baseRunners?: { first: boolean, second: boolean, third: boolean, home: boolean }, fieldLocationData?: any, baseRunnerOuts?: { first: boolean, second: boolean, third: boolean, home: boolean }, baseRunnerOutTypes?: { first: string, second: string, third: string, home: string }, count?: { strikes: number, balls: number, fouls: number }, pitchCount?: number) {
    if (!selectedCell) return

    // Handle incomplete at-bats - use 'single' as placeholder but save special notation with count
    const isIncomplete = notation === 'INCOMPLETE_AT_BAT'
    const result = isIncomplete ? 'single' : interpretHandwriting(notation)
    const finalNotation = isIncomplete ? `INCOMPLETE_AT_BAT COUNT:${count?.strikes || 0}-${count?.balls || 0}-${count?.fouls || 0}-${pitchCount || 0}` : notation
    const runsScored = baseRunners?.home ? 1 : 0
    
    // Log the at-bat data when Save is clicked
    console.log('=== AT-BAT SAVED ===')
    console.log('Player:', selectedCell.playerName)
    console.log('Inning:', selectedCell.inning)
    console.log('Notation:', notation)
    console.log('Result:', result)
    console.log('Base Runners:', baseRunners)
    console.log('Runs Scored:', runsScored)
    console.log('==================')
    
    try {
      // Check if this is an existing at-bat
      const existingAtBat = getAtBatForPlayer(selectedCell.playerId, selectedCell.inning)
      
      if (existingAtBat) {
        // Update existing at-bat
        console.log('Updating existing at-bat:', existingAtBat.id)
        
          const updateData = {
            notation: finalNotation, // Save final notation (handles incomplete at-bats)
            result: result,
            runs_scored: runsScored,
            base_runners: baseRunners || { first: false, second: false, third: false, home: false },
            base_runner_outs: baseRunnerOuts || { first: false, second: false, third: false, home: false },
            out_type: baseRunnerOutTypes ? Object.values(baseRunnerOutTypes).find(type => type !== '') || '' : '',
            field_area: fieldLocationData?.fieldArea || '',
            field_zone: fieldLocationData?.fieldZone || '',
            hit_distance: fieldLocationData?.hitDistance || '',
            hit_angle: fieldLocationData?.hitAngle || ''
          }
        
        const { data, error } = await supabase
          .from('at_bats')
          .update(updateData)
          .eq('id', existingAtBat.id)
          .select(`
            *,
            players (
              first_name,
              last_name,
              jersey_number
            )
          `)
        
          if (error) {
            console.error('Error updating at-bat:', error)
            console.error('Full error details:', JSON.stringify(error, null, 2))
            return
          }
        
        // Update the local state
        setAtBats(prev => prev.map(ab => 
          ab.id === existingAtBat.id ? { ...ab, ...updateData } : ab
        ))
        
        console.log('At-bat successfully updated:', data[0])
      } else {
        // Create new at-bat
        console.log('Creating new at-bat')
        
          const insertData = {
            game_id: game.id,
            player_id: selectedCell.playerId,
            inning: selectedCell.inning,
            at_bat_number: 1, // We'll calculate this properly later
            notation: finalNotation, // Save final notation (handles incomplete at-bats)
            result: result,
            rbi: 0,
            runs_scored: runsScored,
            stolen_bases: 0,
            base_runners: baseRunners || { first: false, second: false, third: false, home: false },
            base_runner_outs: baseRunnerOuts || { first: false, second: false, third: false, home: false },
            out_type: baseRunnerOutTypes ? Object.values(baseRunnerOutTypes).find(type => type !== '') || '' : '',
            field_area: fieldLocationData?.fieldArea || '',
            field_zone: fieldLocationData?.fieldZone || '',
            hit_distance: fieldLocationData?.hitDistance || '',
            hit_angle: fieldLocationData?.hitAngle || ''
          }
        
        const { data, error } = await supabase
          .from('at_bats')
          .insert([insertData])
          .select(`
            *,
            players (
              first_name,
              last_name,
              jersey_number
            )
          `)
        
        if (error) {
          console.error('Error creating at-bat:', error)
          console.error('Full error details:', JSON.stringify(error, null, 2))
          return
        }
        
        // Add to local state
        setAtBats(prev => [...prev, data[0]])
        console.log('At-bat successfully created:', data[0])
      }

      // Close the modal after successful save, but not for incomplete at-bats
      if (!isIncomplete) {
        setShowCanvasModal(false)
        setSelectedCell(null)
      }
    } catch (err) {
      console.error('Failed to save at-bat:', err)
    }
  }

  if (loading) {
    return (
      <div className="flex items-center justify-center p-8">
        <div className="animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600"></div>
        <span className="ml-3 text-gray-600">Loading scorebook...</span>
      </div>
    )
  }

  return (
    <div className="bg-white p-6 max-w-7xl mx-auto">
      {/* Game Information Header */}
      <div className="mb-6">
        <div className="text-center mb-4">
          <h2 className="text-2xl font-bold text-gray-900">vs {gameInfo.opponent}</h2>
        </div>
        
        <div className="grid grid-cols-6 gap-4 text-sm">
          <div>
            <label className="block text-gray-600 mb-1">Date:</label>
            <input
              type="date"
              value={gameInfo.date}
              onChange={(e) => setGameInfo({...gameInfo, date: e.target.value})}
              className="w-full px-2 py-1 border border-gray-300 rounded text-sm"
            />
          </div>
          <div>
            <label className="block text-gray-600 mb-1">Start Time:</label>
            <input
              type="time"
              value={gameInfo.startTime}
              onChange={(e) => setGameInfo({...gameInfo, startTime: e.target.value})}
              className="w-full px-2 py-1 border border-gray-300 rounded text-sm"
            />
          </div>
          <div>
            <label className="block text-gray-600 mb-1">Field:</label>
            <input
              type="text"
              value={gameInfo.field}
              onChange={(e) => setGameInfo({...gameInfo, field: e.target.value})}
              className="w-full px-2 py-1 border border-gray-300 rounded text-sm"
            />
          </div>
          <div>
            <label className="block text-gray-600 mb-1">Length:</label>
            <input
              type="text"
              value={gameInfo.length}
              onChange={(e) => setGameInfo({...gameInfo, length: e.target.value})}
              className="w-full px-2 py-1 border border-gray-300 rounded text-sm"
            />
          </div>
          <div>
            <label className="block text-gray-600 mb-1">Umpire:</label>
            <input
              type="text"
              value={gameInfo.umpire}
              onChange={(e) => setGameInfo({...gameInfo, umpire: e.target.value})}
              className="w-full px-2 py-1 border border-gray-300 rounded text-sm"
            />
          </div>
          <div className="flex items-end">
            <div className="text-right">
              <div className="text-lg font-bold text-gray-900">
                {game.our_score} - {game.opponent_score}
              </div>
              <div className="text-sm text-gray-600">Score</div>
            </div>
          </div>
        </div>
      </div>

      {/* Scorebook Grid */}
      <div className="overflow-x-auto">
        <table className="w-full border-collapse border border-gray-400 text-xs">
          <thead>
            <tr className="bg-gray-100">
              <th className="border border-gray-400 px-2 py-1 w-8">#</th>
              <th className="border border-gray-400 px-2 py-1 w-32">Batter</th>
              <th className="border border-gray-400 px-1 py-1 w-6"></th>
              {Array.from({ length: 10 }, (_, i) => (
                <th key={i} className="border border-gray-400 px-1 py-1 w-16 text-center">
                  {i + 1}
                </th>
              ))}
              <th className="border border-gray-400 px-1 py-1 w-8 text-center">H</th>
              <th className="border border-gray-400 px-1 py-1 w-8 text-center">BB</th>
              <th className="border border-gray-400 px-1 py-1 w-8 text-center">R</th>
              <th className="border border-gray-400 px-1 py-1 w-8 text-center">RBI</th>
              <th className="border border-gray-400 px-1 py-1 w-8 text-center">E</th>
            </tr>
          </thead>
          <tbody>
            {Array.from({ length: 10 }, (_, rowIndex) => {
              const player = players[rowIndex]
              const stats = player ? getPlayerStats(player.id) : { hits: 0, walks: 0, runs: 0, rbi: 0, errors: 0 }
              
              return (
                <tr key={rowIndex} className="h-12">
                  {/* Jersey Number */}
                  <td className="border border-gray-400 px-2 py-1 text-center">
                    {player ? player.jersey_number : ''}
                  </td>
                  
                  {/* Player Name */}
                  <td className="border border-gray-400 px-2 py-1">
                    {player ? `${player.first_name} ${player.last_name}` : ''}
                  </td>
                  
                  {/* Diagonal Line Column */}
                  <td className="border border-gray-400 px-1 py-1 relative">
                    <div className="absolute inset-0 flex items-center justify-center">
                      <div className="w-full h-px bg-gray-400 transform rotate-45"></div>
                    </div>
                  </td>
                  
                  {/* Inning Columns with Diamond Grids */}
                  {Array.from({ length: 10 }, (_, inningIndex) => {
                    const atBat = player ? getAtBatForPlayer(player.id, inningIndex + 1) : null
                    
                    return (
                      <td key={inningIndex} className="border border-gray-400 px-1 py-1 relative">
                        <div 
                          className="w-full h-full flex items-center justify-center cursor-pointer hover:bg-blue-50 active:bg-blue-100 transition-colors"
                          onClick={() => player && handleCellClick(player.id, inningIndex + 1, `${player.first_name} ${player.last_name}`, atBat)}
                        >
                          {/* Diamond Shape */}
                          <div className="relative w-8 h-8">
                            <div className={`absolute inset-0 border border-gray-300 transform rotate-45 ${
                              atBat?.base_runners?.home ? 'bg-blue-600' : '' // Only blue if run scored (home = true)
                            }`}></div>
                            
                            {/* Base highlighting - show which base the runner is on */}
                            {atBat?.base_runners && (
                              <>
                                {/* First base highlight (right side) */}
                                {atBat.base_runners.first && (
                                  <div className="absolute top-1/2 right-0 w-2 h-2 bg-yellow-400 transform rotate-45 -translate-y-1/2 translate-x-1/2"></div>
                                )}
                                {/* Second base highlight (top) */}
                                {atBat.base_runners.second && (
                                  <div className="absolute top-0 left-1/2 w-2 h-2 bg-yellow-400 transform rotate-45 -translate-x-1/2 -translate-y-1/2"></div>
                                )}
                                {/* Third base highlight (left side) */}
                                {atBat.base_runners.third && (
                                  <div className="absolute top-1/2 left-0 w-2 h-2 bg-yellow-400 transform rotate-45 -translate-y-1/2 -translate-x-1/2"></div>
                                )}
                                {/* Home plate highlight (bottom) - only if not run scored (blue diamond) */}
                                {atBat.base_runners.home && (
                                  <div className="absolute bottom-0 left-1/2 w-2 h-2 bg-yellow-400 transform rotate-45 -translate-x-1/2 translate-y-1/2"></div>
                                )}
                              </>
                            )}
                            
                            {/* Red dot indicator for outs */}
                            {atBat?.base_runner_outs && (atBat.base_runner_outs.first || atBat.base_runner_outs.second || atBat.base_runner_outs.third || atBat.base_runner_outs.home) && (
                              <div className="absolute -top-1 -right-1 w-3 h-3 bg-red-500 rounded-full border border-white"></div>
                            )}
                            
                            
                            {/* At-bat result notation - only show if not run scored (blue diamond) */}
                            {atBat && !atBat.base_runners?.home && (
                              <div className="absolute inset-0 flex items-center justify-center text-xs font-bold z-10">
                                {atBat.result === 'single' && '1B'}
                                {atBat.result === 'double' && '2B'}
                                {atBat.result === 'triple' && '3B'}
                                {atBat.result === 'home_run' && 'HR'}
                                {atBat.result === 'walk' && 'BB'}
                                {atBat.result === 'strikeout' && 'K'}
                                {atBat.result === 'ground_out' && 'GO'}
                                {atBat.result === 'fly_out' && 'FO'}
                                {atBat.result === 'line_out' && 'LO'}
                                {atBat.result === 'pop_out' && 'PO'}
                                {atBat.result === 'error' && 'E'}
                                {atBat.result === 'hit_by_pitch' && 'HBP'}
                                {atBat.result === 'sacrifice_fly' && 'SF'}
                                {atBat.result === 'sacrifice_bunt' && 'SAC'}
                              </div>
                            )}
                            
                            {/* Touch indicator when empty */}
                            {!atBat && player && (
                              <div className="absolute inset-0 flex items-center justify-center text-gray-400 text-xs">
                                +
                              </div>
                            )}
                          </div>
                        </div>
                      </td>
                    )
                  })}
                  
                  {/* Summary Statistics */}
                  <td className="border border-gray-400 px-1 py-1 text-center font-bold">
                    {stats.hits}
                  </td>
                  <td className="border border-gray-400 px-1 py-1 text-center font-bold">
                    {stats.walks}
                  </td>
                  <td className="border border-gray-400 px-1 py-1 text-center font-bold">
                    {stats.runs}
                  </td>
                  <td className="border border-gray-400 px-1 py-1 text-center font-bold">
                    {stats.rbi}
                  </td>
                  <td className="border border-gray-400 px-1 py-1 text-center font-bold">
                    {stats.errors}
                  </td>
                </tr>
              )
            })}
          </tbody>
        </table>
      </div>

      {/* Action Buttons */}
      <div className="mt-6 flex justify-between">
        <div className="text-sm text-gray-600">
          <p>• Tap diamond cells to draw on the diamond</p>
          <p>• Draw notation with finger or stylus (K, 6-3, arrows, etc.)</p>
          <p>• Summary columns auto-calculate totals</p>
        </div>
        <div className="space-x-3">
          <button
            onClick={onClose}
            className="bg-gray-600 text-white px-6 py-2 rounded-lg hover:bg-gray-700"
          >
            Close Scorebook
          </button>
        </div>
      </div>

      {/* Canvas Drawing Modal */}
      {showCanvasModal && selectedCell && (
        <DiamondCanvas
          onSave={(notation, baseRunners, fieldLocationData, baseRunnerOuts, baseRunnerOutTypes, count, pitchCount) => {
            saveAtBat(notation, baseRunners, fieldLocationData, baseRunnerOuts, baseRunnerOutTypes, count, pitchCount)
          }}
          onClose={() => {
            setShowCanvasModal(false)
            setSelectedCell(null)
          }}
          playerName={selectedCell.playerName}
          inning={selectedCell.inning}
          existingAtBat={getAtBatForPlayer(selectedCell.playerId, selectedCell.inning)}
        />
      )}
    </div>
  )
}
